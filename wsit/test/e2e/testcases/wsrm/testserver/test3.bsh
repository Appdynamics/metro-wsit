import com.sun.xml.ws.rm.Message;
import com.sun.xml.ws.rm.Sequence;
import com.sun.xml.ws.rm.jaxws.runtime.client.RMSource;
import com.sun.xml.ws.rm.jaxws.runtime.client.ClientOutboundSequence;
import javax.xml.namespace.QName;

QName qname = new QName("http://tempuri.org/", "WSHttpBinding_IPing");
service = new wsrm.testserver.client.PingService();
IPing port = service.getWSHttpBindingIPing();
IPing port2 = service.getWSHttpBindingIPing();



try {
    //create a sequence
    ClientOutboundSequence seq = RMSource.getRMSource().createSequence(service, qname);
    
    id1 = seq.getId();
    assertNotNull(id1);
    
    //specify the use of the sequence for two different proxies
    port.getRequestContext().put("com.sun.xml.ws.sequence", seq);
    port2.getRequestContext().put("com.sun.xml.ws.sequence", seq);

    //verify that the same sequence is internally for the proxy.
    id2 = port.getSequenceID(null);
    assertNotNull(id1);
    assertEquals(id1, id2);

    //verify that the same sequence id is used for both proxies
    id3 = port2.getSequenceID(null);
    assertEquals(id3, id2);

    //make sure that correct messageNumber is present in injected
    //WebServiceContext
    num = port2.getMessageNumber(null);    
    print("message number = " + num); 
    assertEquals(num, "3");

    port.getRequestContext().put("com.sun.xml.ws.messagenumber", 8);
    num = port.getMessageNumber(null);

    print("message number = " + num); 
    
} finally {
    port.close();
}
